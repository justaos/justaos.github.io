{"version":3,"file":"code-editor.js","sourceRoot":"","sources":["../../../../src/components/form/code-editor/code-editor.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAsB,KAAK,EAAgB,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AACxH,OAAO,EAAE,aAAa,EAAE,iBAAiB,EAAE,MAAM,sBAAsB,CAAC;AACxE,OAAO,UAAU,MAAM,0BAA0B,CAAC;AAElD;;;;GAIG;AAMH,MAAM,OAAO,UAAU;EALvB;IAOE,QAAG,GAAW,iBAAiB,EAAE,CAAC;IAGlC;;OAEG;IACK,SAAI,GAAW,cAAc,IAAI,CAAC,GAAG,EAAE,CAAC;IAOhD;;OAEG;IACsB,aAAQ,GAAY,KAAK,CAAC;IAGnD;;OAEG;IACoB,aAAQ,GAAY,KAAK,CAAC;IAE1B,aAAQ,GAAa,KAAK,CAAC;IAE1C,UAAK,GAA2B,UAAU,CAAC;IAE3C,aAAQ,GAAmC,YAAY,CAAC;IAExD,gBAAW,GAAiB,IAAI,CAAC;IAOzC;;OAEG;IACK,aAAQ,GAAG,GAAG,CAAC;IAEd,aAAQ,GAAG,KAAK,CAAC;GAiI3B;EA7HW,eAAe;IACvB,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;EAC9D,CAAC;EAGD,eAAe,CAAC,QAAgB;IAC9B,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,EAAE,QAAQ,EAAE,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAC,CAAC,CAAC;EAClF,CAAC;EAGD,eAAe,CAAC,QAAgB;IAC9B,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,EAAE,QAAQ,EAAE,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAC,CAAC,CAAC;EAClF,CAAC;EAGD,eAAe,CAAC,QAAgB;IAC9B,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC,CAAC;EAC3F,CAAC;EAGD,YAAY,CAAC,QAAgB;IAC3B,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;EAC7C,CAAC;EAGD,YAAY,CAAC,QAAgB;IAC3B,IAAI,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,KAAK,EAAE;MACvD,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;KAC9C;EACH,CAAC;EAGD,KAAK,CAAC,cAAc;IAClB,OAAO,IAAI,CAAC,GAAG,CAAC;EAClB,CAAC;EAED;;;KAGG;EAEH,KAAK,CAAC,QAAQ;IACZ,IAAI,IAAI,CAAC,oBAAoB,EAAE;MAC7B,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE,CAAC;KACnC;EACH,CAAC;EAED;;;KAGG;EAEH,KAAK,CAAC,OAAO;IACX,IAAI,IAAI,CAAC,oBAAoB,EAAE;MAC7B,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC;KAClC;EACH,CAAC;EAKD,KAAK,CAAC,iBAAiB;IACrB,IAAI,CAAC,eAAe,EAAE,CAAC;IACvB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;MACrB,MAAM,UAAU,EAAE,CAAC;KACpB;EACH,CAAC;EAED,gBAAgB;IACd,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,gBAAgB,EAAE,EAAE,IAAI,CAAC,CAAC;EAClD,CAAC;EAEO,gBAAgB;IACtB,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;IAEhC,6EAA6E;IAE7E,IAAI,CAAC,aAAa,CAAC,SAAS,GAAG,EAAE,CAAC;IAElC,IAAI,CAAC,oBAAoB,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE;MACnE,KAAK,EAAE,IAAI,CAAC,KAAK;MACjB,WAAW,EAAE,IAAI,CAAC,WAAW;MAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;MACvB,KAAK,EAAE,IAAI,CAAC,KAAK;MACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ;KACzC,CAAC,CAAC;IAGH,IAAI,CAAC,oBAAoB,CAAC,uBAAuB,CAAC,GAAG,EAAE;MACrD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC;MAClD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,oBAAoB,CAAC,oBAAoB,CAAC,GAAG,EAAE;MAClD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,oBAAoB,CAAC,mBAAmB,CAAC,GAAG,EAAE;MACjD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IACxB,CAAC,CAAC,CAAC;EACL,CAAC;EAED,MAAM;IACJ,OAAO,CACL,EAAC,IAAI;MACH,WAAK,KAAK,EAAE;UACV,WAAW,EAAE,IAAI;UACjB,uBAAuB,EAAE,IAAI;UAC7B,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI;UAClB,UAAU,EAAE,IAAI,CAAC,QAAQ;UACzB,UAAU,EAAE,IAAI,CAAC,QAAQ;UACzB,WAAW,EAAE,IAAI,CAAC,QAAQ;SAC3B;QACC,WAAK,KAAK,EAAC,QAAQ,EAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,GAAG,EAAE,GAAI;QACzD,CAAC,IAAI,CAAC,oBAAoB,IAAI,WAAK,KAAK,EAAC,oBAAoB;UAC5D,oBAAc,KAAK,EAAC,SAAS,GAAG;8BAE5B,CACF,CAGD,CACR,CAAC;EACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAEF","sourcesContent":["import { Component, ComponentInterface, Event, EventEmitter, h, Host, Method, Prop, State, Watch } from '@stencil/core';\r\nimport { debounceEvent, getComponentIndex } from '../../../utils/utils';\r\nimport loadMonaco from '../../../3d-party/monaco';\r\n\r\n/**\r\n * @name Code Editor\r\n * @description A browser based code editor.\r\n * @img /assets/img/code-editor.png\r\n */\r\n@Component({\r\n  tag: 'goat-code-editor',\r\n  styleUrl: 'code-editor.scss',\r\n  shadow: true,\r\n})\r\nexport class CodeEditor implements ComponentInterface, InputComponentInterface {\r\n\r\n  gid: string = getComponentIndex();\r\n\r\n\r\n  /**\r\n   * The input field name.\r\n   */\r\n  @Prop() name: string = `goat-input-${this.gid}`;\r\n\r\n  /**\r\n   * The input field value.\r\n   */\r\n  @Prop({ mutable: true }) value: string;\r\n\r\n  /**\r\n   * If true, required icon is show. Defaults to `false`.\r\n   */\r\n  @Prop({ reflect: true }) required: boolean = false;\r\n\r\n\r\n  /**\r\n   * If true, the user cannot interact with the button. Defaults to `false`.\r\n   */\r\n  @Prop({reflect: true}) disabled: boolean = false;\r\n\r\n  @Prop({reflect: true}) readonly : boolean = false;\r\n\r\n  @Prop() theme: 'vs-light' | 'vs-dark' = 'vs-light';\r\n\r\n  @Prop() language: 'javascript' | 'json' | 'html' = 'javascript';\r\n\r\n  @Prop() lineNumbers: 'off' | 'on' = 'on';\r\n\r\n  /**\r\n   * Emitted when the value has changed..\r\n   */\r\n  @Event({ eventName: 'goat:change' }) p4Change: EventEmitter;\r\n\r\n  /**\r\n   * Set the amount of time, in milliseconds, to wait to trigger the `onChange` event after each keystroke.\r\n   */\r\n  @Prop() debounce = 250;\r\n\r\n  @State() hasFocus = false;\r\n\r\n\r\n  @Watch('debounce')\r\n  protected debounceChanged() {\r\n    this.p4Change = debounceEvent(this.p4Change, this.debounce);\r\n  }\r\n\r\n  @Watch('disabled')\r\n  disabledWatcher(newValue: string) {\r\n    this.editorMonacoInstance.updateOptions({ readOnly: newValue || this.readonly});\r\n  }\r\n\r\n  @Watch('readonly')\r\n  readonlyWatcher(newValue: string) {\r\n    this.editorMonacoInstance.updateOptions({ readOnly: newValue || this.disabled});\r\n  }\r\n\r\n  @Watch('language')\r\n  languageWatcher(newValue: string) {\r\n    window['monaco'].editor.setModelLanguage(this.editorMonacoInstance.getModel(), newValue);\r\n  }\r\n\r\n  @Watch('theme')\r\n  themeWatcher(newValue: string) {\r\n    window['monaco'].editor.setTheme(newValue);\r\n  }\r\n\r\n  @Watch('value')\r\n  valueWatcher(newValue: string) {\r\n    if (this.editorMonacoInstance.getValue() !== this.value) {\r\n      this.editorMonacoInstance.setValue(newValue);\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async getComponentId() {\r\n    return this.gid;\r\n  }\r\n\r\n  /**\r\n   * Sets focus on the native `input` in `goat-input`. Use this method instead of the global\r\n   * `input.focus()`.\r\n   */\r\n  @Method()\r\n  async setFocus() {\r\n    if (this.editorMonacoInstance) {\r\n      this.editorMonacoInstance.focus();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets blur on the native `input` in `goat-input`. Use this method instead of the global\r\n   * `input.blur()`.\r\n   */\r\n  @Method()\r\n  async setBlur() {\r\n    if (this.editorMonacoInstance) {\r\n      this.editorMonacoInstance.blur();\r\n    }\r\n  }\r\n\r\n  private editorElement?: HTMLElement;\r\n  @State() editorMonacoInstance: any;\r\n\r\n  async componentWillLoad() {\r\n    this.debounceChanged();\r\n    if (!window['monaco']) {\r\n      await loadMonaco();\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    setTimeout(() => this.initializeMonaco(), 1000);\r\n  }\r\n\r\n  private initializeMonaco() {\r\n    const monaco = window['monaco'];\r\n\r\n    //monaco.languages.typescript.javascriptDefaults.addExtraLib(this.extraLibs);\r\n\r\n    this.editorElement.innerHTML = '';\r\n\r\n    this.editorMonacoInstance = monaco.editor.create(this.editorElement, {\r\n      value: this.value,\r\n      lineNumbers: this.lineNumbers,\r\n      language: this.language,\r\n      theme: this.theme,\r\n      readOnly: this.disabled || this.readonly,\r\n    });\r\n\r\n\r\n    this.editorMonacoInstance.onDidChangeModelContent(() => {\r\n      this.value = this.editorMonacoInstance.getValue();\r\n      this.p4Change.emit({ value: this.value });\r\n    });\r\n\r\n    this.editorMonacoInstance.onDidFocusEditorText(() => {\r\n      this.hasFocus = true;\r\n    });\r\n\r\n    this.editorMonacoInstance.onDidBlurEditorText(() => {\r\n      this.hasFocus = false;\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class={{\r\n          'component': true,\r\n          'code-editor-component': true,\r\n          [this.theme]: true,\r\n          'disabled': this.disabled,\r\n          'readonly': this.readonly,\r\n          'has-focus': this.hasFocus,\r\n        }}>\r\n          <div class='editor' ref={el => this.editorElement = el} />\r\n          {!this.editorMonacoInstance && <div class='code-editor-loader'>\r\n            <goat-spinner class='rainbow' />\r\n            Loading editor...\r\n          </div>}\r\n        </div>\r\n\r\n\r\n      </Host>\r\n    );\r\n  }\r\n\r\n}\r\n"]}