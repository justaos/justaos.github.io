{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/components/calendar/calendar/utils.tsx"],"names":[],"mappings":"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","sourcesContent":["import { endOfMonth, endOfWeek, startOfMonth, startOfWeek } from 'date-fns/esm';\r\nimport CalendarEvent from './CalendarEvent';\r\nimport { differenceInMilliseconds } from 'date-fns';\r\n\r\n\r\n/**\r\n * Calculates start and end dates of month in a calendar.\r\n * @param date Context date for which range need to calculated.\r\n * @param weekStartsOn A numeric value. The index of the first day of the week (0 - Sunday)\r\n */\r\nexport function calculateMonthRange(date, weekStartsOn: 0 | 1 | 2 | 3 | 4 | 5 | 6 = 1) {\r\n  const startDate = startOfWeek(startOfMonth(date), { weekStartsOn });\r\n  const endDate = endOfWeek(endOfMonth(date), { weekStartsOn });\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    totalDays: 42,\r\n  };\r\n}\r\n\r\n/*\r\n *\r\n */\r\nexport function calculateWeekRange(date, weekStartsOn: 0 | 1 | 2 | 3 | 4 | 5 | 6 = 1) {\r\n  const startDate = startOfWeek(date, { weekStartsOn });\r\n  const endDate = endOfWeek(date, { weekStartsOn });\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    totalDays: 7,\r\n  };\r\n}\r\n\r\nexport class EventNode {\r\n  event: CalendarEvent;\r\n\r\n  width: number = 1;\r\n\r\n  constructor(event) {\r\n    this.event = event;\r\n  }\r\n\r\n}\r\n\r\n\r\nexport class EventBucket {\r\n\r\n  eventNodes: EventNode[] = [];\r\n\r\n  columns: EventNode[][];\r\n\r\n  constructor() {\r\n\r\n  }\r\n\r\n\r\n  insert(node: EventNode) {\r\n    this.eventNodes.push(node);\r\n  }\r\n\r\n  process() {\r\n    this.columns = [];\r\n    let events = this.eventNodes.sort((a, b) => {\r\n      return differenceInMilliseconds(a.event.start, b.event.start) || b.event.length() - a.event.length();\r\n    });\r\n\r\n    let oldLength = null;\r\n    /* Bucketing */\r\n    while (events.length) {\r\n      if (oldLength == events.length)\r\n        throw new Error('Events not processed in previous run, breaking infinite loop');\r\n      oldLength = events.length;\r\n\r\n      const column = [];\r\n      for (let i = 0; i < events.length; i++) {\r\n        if (i == 0)\r\n          column.push(events[i]);\r\n        else if (differenceInMilliseconds(events[i].event.start, column[column.length - 1].event.end) >= 0) {\r\n          column.push(events[i]);\r\n        }\r\n      }\r\n      this.columns.push(column);\r\n      events = events.filter((e) => {\r\n        return !column.find((ce) => {\r\n          return ce.event == e.event;\r\n        });\r\n      });\r\n    }\r\n\r\n    for (let i = 0; i < this.columns.length - 1; i++) {\r\n\r\n      this.columns[i].forEach((event) => {\r\n        for (let j = i + 1; j < this.columns.length; j++) {\r\n          if (this.columns[j].find((colEvent) => {\r\n            return this.#eventOverlapping(event.event, colEvent.event);\r\n          })) {\r\n            break;\r\n          }\r\n          event.width++;\r\n        }\r\n      });\r\n\r\n    }\r\n  }\r\n\r\n  #eventOverlapping(eventA: CalendarEvent, eventB: CalendarEvent) {\r\n    if (differenceInMilliseconds(eventA.start, eventB.start) > 0) {\r\n      const temp = eventA;\r\n      eventA = eventB;\r\n      eventB = temp;\r\n    }\r\n    const totalLength = differenceInMilliseconds(eventB.end, eventA.start);\r\n    return totalLength < eventA.length() + eventB.length();\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n"]}